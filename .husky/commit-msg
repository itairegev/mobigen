#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Validate commit message format
# Enforces conventional commits: type(scope): description
# Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Conventional commit pattern
# Format: type(optional scope): description
# Examples:
#   feat: add new feature
#   fix(api): resolve bug in endpoint
#   docs: update README

conventional_pattern="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,}"

if ! echo "$commit_msg" | grep -qE "$conventional_pattern"; then
  echo "❌ Invalid commit message format!"
  echo ""
  echo "Commit message must follow conventional commits format:"
  echo "  <type>(optional scope): <description>"
  echo ""
  echo "Valid types:"
  echo "  - feat:     A new feature"
  echo "  - fix:      A bug fix"
  echo "  - docs:     Documentation only changes"
  echo "  - style:    Code style changes (formatting, etc.)"
  echo "  - refactor: Code change that neither fixes a bug nor adds a feature"
  echo "  - test:     Adding or updating tests"
  echo "  - chore:    Maintenance tasks, dependencies, etc."
  echo "  - perf:     Performance improvements"
  echo "  - ci:       CI/CD configuration changes"
  echo "  - build:    Build system or external dependencies"
  echo "  - revert:   Revert a previous commit"
  echo ""
  echo "Examples:"
  echo "  feat: add user authentication"
  echo "  fix(api): resolve timeout issue"
  echo "  docs: update installation guide"
  echo ""
  echo "Your commit message:"
  echo "  $commit_msg"
  echo ""
  exit 1
fi

echo "✓ Commit message format is valid"
